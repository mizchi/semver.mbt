// Generated by wit-bindgen-moonbit
// DO NOT EDIT - this file is regenerated

/// Export trait for semver
pub(open) trait Exports {
  compare_versions(Self, version_a : String, version_b : String) -> Int
  increment_version(Self, version_str : String, release_type : String) -> String
  is_prerelease(Self, version_str : String) -> Bool
  parse_version(Self, version_str : String) -> String
}

let exports_impl : Ref[&Exports?] = { val: None }

pub fn register(impl_ : &Exports) -> Unit {
  exports_impl.val = Some(impl_)
}

fn get_exports() -> &Exports {
  guard exports_impl.val is Some(impl_) else {
    abort("exports not registered")
  }
  impl_
}

///| Re-export cabi_realloc for wasm linking
pub fn cabi_realloc(
  old_ptr : Int,
  old_size : Int,
  align : Int,
  new_size : Int,
) -> Int {
  @cabi.cabi_realloc(old_ptr, old_size, align, new_size)
}

pub fn wasmExportCompareVersions(version_a_ptr : Int, version_a_len : Int, version_b_ptr : Int, version_b_len : Int) -> Int {
  let version_a = @cabi.cabi_lift_string(version_a_ptr, version_a_len)
  let version_b = @cabi.cabi_lift_string(version_b_ptr, version_b_len)
  get_exports().compare_versions(version_a, version_b)
}

pub fn wasmExportIncrementVersion(version_str_ptr : Int, version_str_len : Int, release_type_ptr : Int, release_type_len : Int) -> Int {
  let version_str = @cabi.cabi_lift_string(version_str_ptr, version_str_len)
  let release_type = @cabi.cabi_lift_string(release_type_ptr, release_type_len)
  let result = get_exports().increment_version(version_str, release_type)
  let (ptr, len) = @cabi.cabi_lower_string(result)
  let retptr = @cabi.cabi_realloc(0, 0, 4, 8)
  @cabi.cabi_write_i32(retptr, ptr)
  @cabi.cabi_write_i32(retptr + 4, len)
  retptr
}

pub fn wasmExportIsPrerelease(version_str_ptr : Int, version_str_len : Int) -> Bool {
  let version_str = @cabi.cabi_lift_string(version_str_ptr, version_str_len)
  get_exports().is_prerelease(version_str)
}

pub fn wasmExportParseVersion(version_str_ptr : Int, version_str_len : Int) -> Int {
  let version_str = @cabi.cabi_lift_string(version_str_ptr, version_str_len)
  let result = get_exports().parse_version(version_str)
  let (ptr, len) = @cabi.cabi_lower_string(result)
  let retptr = @cabi.cabi_realloc(0, 0, 4, 8)
  @cabi.cabi_write_i32(retptr, ptr)
  @cabi.cabi_write_i32(retptr + 4, len)
  retptr
}

///|
fn main {
  ()
}
